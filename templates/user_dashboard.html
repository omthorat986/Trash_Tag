{% extends 'layout.html' %}

{% block content %}
<style>
  :root {
    --primary-green: #16a34a;
    --primary-green-dark: #15803d;
    --light-green: #f0fdf4;
    --dark-green-text: #065f46;
    --text-color: #334155;
    --background-color: #f1f5f9;
    --card-bg: rgba(255, 255, 255, 0.7);
    --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
    --card-shadow-hover: 0 12px 25px rgba(0, 0, 0, 0.12);
  }

  body {
    background: linear-gradient(135deg, #e6f9f0 0%, #f8fafc 100%);
    font-family: 'Inter', sans-serif;
  }

  .dashboard-container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 3rem 1.5rem;
  }

  .dashboard-header {
    text-align: center;
    margin-bottom: 4rem;
  }
  .dashboard-header h1 {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.8rem;
    font-weight: 800;
    background: linear-gradient(90deg, var(--primary-green), var(--dark-green-text));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.5rem;
  }
  .dashboard-header p {
    font-size: 1.15rem;
    color: var(--text-color);
    opacity: 0.9;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2.5rem;
  }

  .dashboard-card {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border-radius: 20px;
    padding: 2.5rem 2rem;
    text-align: center;
    color: var(--text-color);
    text-decoration: none;
    box-shadow: var(--card-shadow);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .dashboard-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: var(--card-shadow-hover);
  }

  .card-icon-wrap {
    background: linear-gradient(135deg, var(--primary-green), var(--primary-green-dark));
    width: 70px;
    height: 70px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    margin: 0 auto 1.5rem;
    color: white;
    box-shadow: 0 6px 15px rgba(22, 163, 74, 0.3);
    transition: transform 0.3s;
  }
  .dashboard-card:hover .card-icon-wrap {
    transform: rotate(8deg) scale(1.05);
  }
  .card-icon { width: 36px; height: 36px; }

  .card-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 1.2rem;
    color: var(--dark-green-text);
  }

  .card-button {
    background: var(--primary-green);
    color: #fff;
    padding: 0.75rem 2rem;
    border-radius: 999px;
    font-weight: 600;
    display: inline-block;
    transition: background 0.25s, transform 0.25s;
  }
  .card-button:hover {
    background: var(--primary-green-dark);
    transform: translateY(-2px);
  }

  /* Rating Section */
  .rating-section {
    margin-top: 4rem;
    background: #ffffffdd;
    padding: 2rem;
    border-radius: 20px;
    box-shadow: var(--card-shadow);
  }
  .rating-section h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--dark-green-text);
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    font-size: 0.95rem;
  }
  th, td {
    padding: 12px;
    border-bottom: 1px solid #e2e8f0;
    text-align: center;
  }
  th {
    background: #f1f5f9;
    color: var(--dark-green-text);
    font-weight: 600;
  }
  select, button {
    padding: 0.4rem 0.6rem;
    border-radius: 6px;
    border: 1px solid #cbd5e1;
    font-size: 0.9rem;
  }
  button {
    background: var(--primary-green);
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: var(--primary-green-dark);
  }
</style>

<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Welcome, {{ current_user.username }}!</h1>
    <p>Your eco-command center is ready. Let's keep our community clean üåø</p>
  </div>

  <!-- Existing cards -->
  <div class="dashboard-grid">
    <a href="{{ url_for('request_cleanup') }}" class="dashboard-card">
      <div class="card-icon-wrap">
        <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
        </svg>
      </div>
      <h3 class="card-title">Request For Cleanup</h3>
      <div class="card-button">Start</div>
    </a>

    <a href="{{ url_for('request_cleanup') }}" class="dashboard-card">
      <div class="card-icon-wrap">
        <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.776 48.776 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
        </svg>
      </div>
      <h3 class="card-title">Record Your Cleanup</h3>
      <div class="card-button">Upload Photo</div>
    </a>

    <a href="{{ url_for('my_statistics') }}" class="dashboard-card">
      <div class="card-icon-wrap">
        <svg class="card-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
        </svg>
      </div>
      <h3 class="card-title">View My Statistics</h3>
      <div class="card-button">View Stats</div>
    </a>
  </div>

  <!-- ‚úÖ Cleaner Rating Section -->
  <div class="rating-section">
    <h2>Rate the Cleaners Who Completed Your Requests</h2>
    <table>
      <thead>
        <tr>
          <th>Location</th>
          <th>Cleaner</th>
          <th>Completed At</th>
          <th>Your Rating</th>
        </tr>
      </thead>
      <tbody>
      {% for report in completed_reports %}
        <tr>
          <td>{{ report.location }}</td>
          <td>{{ report.submitted_by_cleaner.username if report.submitted_by_cleaner else 'Unknown' }}</td>
          <td>{{ report.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
          <td>
            {% if report.rating %}
              ‚≠ê {{ report.rating }}/5
            {% else %}
              <form action="{{ url_for('rate_cleaner', report_id=report.id) }}" method="POST">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <select name="rating" required>
                  <option value="">Select</option>
                  {% for i in range(1,6) %}
                    <option value="{{ i }}">{{ i }}</option>
                  {% endfor %}
                </select>
                <button type="submit" class="btn-submit">Rate</button>
              </form>
            {% endif %}
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="4">No completed cleanups to rate yet.</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
